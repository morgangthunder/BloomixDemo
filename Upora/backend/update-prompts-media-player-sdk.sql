-- Update AI prompts to include Media Player SDK functionality
-- This adds Media Player interaction SDK methods and capabilities

-- 1. Update SDK Content prompt (used by AI Teacher for all interactions)
UPDATE ai_prompts
SET content = content || E'\n\n## Media Player Interactions (uploaded-media category)\n\nMedia Player interactions support all standard SDK methods PLUS media control methods:\n\n### Media Control Methods:\n- `aiSDK.playMedia()` - Play the media player (returns Promise)\n- `aiSDK.pauseMedia()` - Pause the media player\n- `aiSDK.seekMedia(time)` - Seek to a specific time in seconds\n- `aiSDK.setMediaVolume(volume)` - Set volume (0.0 to 1.0)\n- `aiSDK.getMediaCurrentTime()` - Get current playback time in seconds\n- `aiSDK.getMediaDuration()` - Get total duration in seconds\n- `aiSDK.isMediaPlaying()` - Check if media is currently playing\n\n### Media Player Integration:\n- Media Player interactions use an overlay system (HTML/CSS/JS) injected into the media player component\n- Overlay is positioned at the bottom of the media player by default\n- Media playback automatically syncs with lesson play/pause controls\n- Lesson timer syncs with media playback time\n- Media file comes from processed content (video or audio file uploaded and approved)\n\n### Example Media Player Interaction:\n```javascript\nconst aiSDK = createIframeAISDK();\n\naiSDK.isReady((ready) => {\n  if (ready) {\n    // Check media time periodically\n    setInterval(() => {\n      const currentTime = aiSDK.getMediaCurrentTime();\n      \n      // Show question at 30 seconds\n      if (currentTime >= 30 && !questionShown) {\n        questionShown = true;\n        aiSDK.pauseMedia();\n        aiSDK.showScript("Let''s pause here. What did the narrator say?");\n      }\n    }, 1000);\n  }\n});\n```\n\n### Media Player Overlay:\n- Overlay HTML/CSS/JS is defined in the interaction builder Code tab\n- Overlay appears on top of the media player\n- Overlay can interact with the SDK to control media playback\n- Overlay can display buttons, forms, or other interactive elements'
WHERE assistant_id = 'ai-interaction-handler' AND prompt_key = 'sdk-content';

-- 2. Create/Update Media Player interaction prompt for Inventor (interaction builder assistant)
INSERT INTO ai_prompts (assistant_id, prompt_key, content, created_at, updated_at)
VALUES (
  'inventor',
  'media-player-interaction',
  E'You are helping a user build a Media Player interaction in the interaction builder.\n\n## Media Player Interactions\n\nMedia Player interactions allow you to create interactive overlays on top of video or audio content. The media file is uploaded and approved as a content source, then selected in the interaction configuration.\n\n## SDK Methods Available\n\n### Standard SDK Methods (all interaction types):\n- `aiSDK.emitEvent(event)` - Emit events to AI Teacher\n- `aiSDK.updateState(key, value)` - Update interaction state\n- `aiSDK.getState(callback)` - Get current state\n- `aiSDK.onResponse(callback)` - Subscribe to AI responses\n- `aiSDK.isReady(callback)` - Check if SDK is ready\n- `aiSDK.minimizeChatUI()` - Minimize chat widget\n- `aiSDK.showChatUI()` - Show chat widget\n- `aiSDK.activateFullscreen()` - Activate fullscreen\n- `aiSDK.deactivateFullscreen()` - Deactivate fullscreen\n- `aiSDK.postToChat(content, role, openChat)` - Post to chat\n- `aiSDK.showScript(text, openChat)` - Show script block\n- `aiSDK.showSnack(content, duration, hideFromChatUI)` - Show snack message\n- `aiSDK.hideSnack()` - Hide snack\n- `aiSDK.saveInstanceData(data)` - Save anonymous instance data\n- `aiSDK.getInstanceDataHistory(filters)` - Get instance data history\n- `aiSDK.saveUserProgress(data)` - Save user progress\n- `aiSDK.getUserProgress()` - Get user progress\n- `aiSDK.updateUserProgress(updates)` - Update user progress\n- `aiSDK.markCompleted()` - Mark as completed\n- `aiSDK.incrementAttempts()` - Increment attempts\n- `aiSDK.getUserPublicProfile(userId)` - Get user public profile\n\n### Media Control Methods (Media Player only):\n- `aiSDK.playMedia()` - Play the media player (returns Promise)\n- `aiSDK.pauseMedia()` - Pause the media player\n- `aiSDK.seekMedia(time)` - Seek to a specific time in seconds\n- `aiSDK.setMediaVolume(volume)` - Set volume (0.0 to 1.0)\n- `aiSDK.getMediaCurrentTime()` - Get current playback time in seconds (callback)\n- `aiSDK.getMediaDuration()` - Get total duration in seconds (callback)\n- `aiSDK.isMediaPlaying()` - Check if media is currently playing (callback)\n\n## Media Player Structure\n\nMedia Player interactions use an overlay system:\n- **Overlay HTML**: HTML structure for the overlay (injected into media player)\n- **Overlay CSS**: Styles for the overlay (positioned at bottom by default)\n- **Overlay JS**: JavaScript code that runs in the overlay context\n\n## Creating a Media Player Interaction\n\n1. **Select Media File**: In the Settings tab, click "Select Media" to choose an approved video or audio file\n2. **Define Overlay**: Use the Code tab to define HTML, CSS, and JavaScript for the overlay\n3. **Use SDK**: Include `createIframeAISDK()` function and use SDK methods to interact with media and AI Teacher\n\n## Example Media Player Overlay Code\n\n### HTML:\n```html\n<div id="media-overlay">\n  <div id="controls">\n    <button id="play-pause-btn">Play</button>\n    <input type="range" id="volume-slider" min="0" max="100" value="100">\n  </div>\n  <div id="quiz-section"></div>\n</div>\n```\n\n### CSS:\n```css\n#media-overlay {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background: rgba(15, 15, 35, 0.95);\n  padding: 20px;\n  z-index: 1000;\n}\n```\n\n### JavaScript:\n```javascript\nconst aiSDK = createIframeAISDK();\n\naiSDK.isReady((ready) => {\n  if (ready) {\n    // Play/Pause button\n    document.getElementById('play-pause-btn').onclick = () => {\n      aiSDK.isMediaPlaying((isPlaying) => {\n        if (isPlaying) {\n          aiSDK.pauseMedia();\n        } else {\n          aiSDK.playMedia();\n        }\n      });\n    };\n    \n    // Volume slider\n    document.getElementById('volume-slider').oninput = (e) => {\n      aiSDK.setMediaVolume(e.target.value / 100);\n    };\n    \n    // Show question at 30 seconds\n    let questionShown = false;\n    setInterval(() => {\n      aiSDK.getMediaCurrentTime((time) => {\n        if (time >= 30 && !questionShown) {\n          questionShown = true;\n          aiSDK.pauseMedia();\n          aiSDK.showScript("What did the narrator say about the main topic?");\n        }\n      });\n    }, 1000);\n  }\n});\n```\n\n## Data Storage\n\nMedia Player interactions support all standard data storage methods:\n- Instance Data (anonymous, all students): `aiSDK.saveInstanceData(data)`\n- User Progress (per-user): `aiSDK.saveUserProgress({ score, completed, customData })`\n- Access historical data: `aiSDK.getInstanceDataHistory()` (builders/admins only)\n- Get user progress: `aiSDK.getUserProgress()`\n- Mark completed: `aiSDK.markCompleted()`\n- Increment attempts: `aiSDK.incrementAttempts()`\n\n## Media Player Integration\n\n- Media playback automatically syncs with lesson play/pause controls\n- Lesson timer syncs with media playback time\n- Media file URL comes from processed content\n- Overlay appears on top of the media player\n\n## Best Practices\n\n- Use media control methods to create interactive quizzes, annotations, or guided viewing experiences\n- Pause media at key moments to ask questions or provide explanations\n- Use `getMediaCurrentTime()` to trigger events at specific timestamps\n- Sync overlay UI with media playback state using `isMediaPlaying()`\n- Store user progress and interaction data for analytics',
  NOW(),
  NOW()
)
ON CONFLICT (assistant_id, prompt_key) 
DO UPDATE SET 
  content = EXCLUDED.content,
  updated_at = NOW();

-- 3. Update General interaction prompt to mention Media Player
UPDATE ai_prompts
SET content = content || E'\n\n## Media Player Interactions (uploaded-media category)\n\nMedia Player interactions support all standard SDK methods PLUS media control methods:\n- `aiSDK.playMedia()` - Play media\n- `aiSDK.pauseMedia()` - Pause media\n- `aiSDK.seekMedia(time)` - Seek to time\n- `aiSDK.setMediaVolume(volume)` - Set volume\n- `aiSDK.getMediaCurrentTime()` - Get current time\n- `aiSDK.getMediaDuration()` - Get duration\n- `aiSDK.isMediaPlaying()` - Check playing status\n\nMedia Player interactions use an overlay system (HTML/CSS/JS) injected into the media player component. The overlay appears at the bottom of the media player and can interact with the SDK to control playback.'
WHERE assistant_id = 'inventor' AND prompt_key = 'general';

